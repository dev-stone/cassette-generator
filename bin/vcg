#!/usr/bin/env php
<?php

use Vcg\Configuration\Configuration;
use Vcg\Maker\Collector;
use Vcg\Maker\RecordOutputMaker;
use Vcg\Writer\CassetteWriter;
use Vcg\Writer\WriterPreprocessor;

require 'vendor/autoload.php';

if (1 === $argc) {
    echo 'Please provide configuration file path!' . PHP_EOL;
    return 1;
}

$configPath = $argv[1];

if (!file_exists($configPath) || !is_file($configPath)) {
    echo 'Config file not exist!' . PHP_EOL;
    return 1;
}

$configuration = new Configuration($configPath);
$collector = new Collector($configuration);
$collector->collect();
$cassettesHolders = $collector->getCassettesHolders();
$recordOutputMaker = new RecordOutputMaker();

$preprocessor = new WriterPreprocessor($recordOutputMaker);
$cassettesOutputs = $preprocessor->prepareCassettes($cassettesHolders);

$cassettesWriter = new CassetteWriter();
$cassettesWriter->write($cassettesOutputs);


echo 'Success.' . PHP_EOL;