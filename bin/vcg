#!/usr/bin/env php
<?php

use Vcg\Configuration\Configuration;
use Vcg\Core\RecordDataCollector;
use Vcg\Core\CassetteWriter;
use Vcg\Core\WriterPreprocessor;

require 'vendor/autoload.php';

if (1 === $argc) {
    echo 'Please provide configuration file path!' . PHP_EOL;
    return 1;
}

$configPath = $argv[1];

if (!file_exists($configPath) || !is_file($configPath)) {
    echo 'Configuration file not exist!' . PHP_EOL;
    return 1;
}

$configuration = new Configuration($configPath);
$cassettesHolders = (new RecordDataCollector($configuration))->collect();
$cassettesOutputs = (new WriterPreprocessor())->prepareCassettes($cassettesHolders);

$cassettesWriter = new CassetteWriter();
$cassettesWriter->write($cassettesOutputs);

echo 'Success.' . PHP_EOL;