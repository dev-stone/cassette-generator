#!/usr/bin/env php
<?php

use Vcg\Collector\DataCollector;
use Vcg\Configuration;
use Vcg\Parser\YamlParser;
use Vcg\Writer\OutputWriter;

require 'vendor/autoload.php';

if (1 === $argc) {
    echo 'Please provide configuration file path!' . PHP_EOL;
    return 1;
}

$configPath = $argv[1];

if (!file_exists($configPath) || !is_file($configPath)) {
    echo 'Config file not exist!' . PHP_EOL;
    return 1;
}

$config = new Configuration($configPath);
$data = (new DataCollector($config))->getData();
$yamlParser = new YamlParser($data);
$yamlParserData = $yamlParser->getData();
$file = $yamlParserData[0]['outputFile'];
$outputWriter = (new OutputWriter())
    ->setParser($yamlParser)
    ->setOutputFile($file);

$outputWriter->writeOutput();

echo 'Success.' . PHP_EOL;